

<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>EOSIO Smart Contract &#8212; Teos python 1.0 documentation</title>
    <link rel="stylesheet" href="_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="index.html">Teos python 1.0 documentation</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">EOSIO Smart Contract</a><ul>
<li><a class="reference internal" href="#introduction-to-eosio-smart-contract">Introduction to EOSIO Smart Contract</a><ul>
<li><a class="reference internal" href="#required-background-knowledge">Required Background Knowledge</a></li>
<li><a class="reference internal" href="#basics-of-eosio-smart-contract">Basics of EOSIO Smart Contract</a></li>
</ul>
</li>
<li><a class="reference internal" href="#smart-contract-files">Smart Contract Files</a><ul>
<li><a class="reference internal" href="#wast">wast</a></li>
<li><a class="reference internal" href="#abi">abi</a></li>
</ul>
</li>
<li><a class="reference internal" href="#debugging-smart-contract">Debugging Smart Contract</a><ul>
<li><a class="reference internal" href="#method">Method</a></li>
<li><a class="reference internal" href="#print">Print</a></li>
<li><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/Smart-Contract.md.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="eosio-smart-contract">
<span id="eosio-smart-contract"></span><h1>EOSIO Smart Contract<a class="headerlink" href="#eosio-smart-contract" title="Permalink to this headline">¶</a></h1>
<p>We rephrase an <a class="reference external" href="#https://github.com/EOSIO/eos/wiki/Smart%20Contract">article</a> from the EOSIO wiki.</p>
<ul class="simple">
<li><a class="reference external" href="#introduction-to-eos-smart-contract">Introduction to EOSIO Smart Contract</a><ul>
<li><a class="reference external" href="#required-background-knowledge">Required Background Knowledge</a></li>
<li><a class="reference external" href="#basics-of-eos-smart-contract">Basics of EOSIO Smart Contract</a></li>
<li><a class="reference external" href="#technical-limitation">Technical Limitation</a></li>
</ul>
</li>
<li><a class="reference external" href="#smart-contract-files">Smart Contract Files</a><ul>
<li><a class="reference external" href="#hpp">hpp</a></li>
<li><a class="reference external" href="#cpp">cpp</a></li>
<li><a class="reference external" href="#wast">wast</a></li>
<li><a class="reference external" href="#abi">abi</a></li>
</ul>
</li>
<li><a class="reference external" href="#debugging-smart-contract">Debugging Smart Contract</a><ul>
<li><a class="reference external" href="#method">Method</a></li>
<li><a class="reference external" href="#print">Print</a></li>
<li><a class="reference external" href="#example">Example</a></li>
</ul>
</li>
</ul>
<!-- /MarkdownTOC --><div class="section" id="introduction-to-eosio-smart-contract">
<span id="introduction-to-eosio-smart-contract"></span><h2>Introduction to EOSIO Smart Contract<a class="headerlink" href="#introduction-to-eosio-smart-contract" title="Permalink to this headline">¶</a></h2>
<div class="section" id="required-background-knowledge">
<span id="required-background-knowledge"></span><h3>Required Background Knowledge<a class="headerlink" href="#required-background-knowledge" title="Permalink to this headline">¶</a></h3>
<p><strong>C / C++ Experience</strong></p>
<p>EOSIO based blockchains execute user-generated applications and code using <a class="reference external" href="http://webassembly.org/">WebAssembly</a> (WASM). WASM is an emerging web standard with widespread support of Google, Microsoft, Apple, and others. At the moment the most mature toolchain for building applications that compile to WASM is <a class="reference external" href="https://clang.llvm.org/">clang/llvm</a> with their C/C++ compiler.</p>
<p>Other toolchains in development by 3rd parties include: Rust, Python, and Solidity. While these other languages may appear simpler, their performance will likely impact the scale of application you can build. We expect that C++ will be the best language for developing high-performance and secure smart contracts and plan to use C++ for the foreseeable future.</p>
<p><strong>Python Knowledge</strong></p>
<p>We use Python scripts for steering the flow of data. Python is renowned for its intuitive simplicity.</p>
<p>Let you start Python in the <code class="docutils literal notranslate"><span class="pre">eosfactory/teos_python</span></code> directory (issue <code class="docutils literal notranslate"><span class="pre">python3</span></code> UBUNTU bash command). Then launch the <code class="docutils literal notranslate"><span class="pre">teos</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">teos</span>
<span class="n">teos</span><span class="o">.</span><span class="n">set_verbose</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>The response is the path to the <code class="docutils literal notranslate"><span class="pre">teos</span></code> executable which drives functions of the <code class="docutils literal notranslate"><span class="pre">teos.py</span></code> module.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">teos</span> <span class="n">exe</span><span class="p">:</span> <span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">Workspaces</span><span class="o">/</span><span class="n">EOS</span><span class="o">/</span><span class="n">eosfactory</span><span class="o">/</span><span class="n">teos</span><span class="o">/</span><span class="n">build</span><span class="o">/</span><span class="n">teos</span>
</pre></div>
</div>
</div>
<div class="section" id="basics-of-eosio-smart-contract">
<span id="basics-of-eosio-smart-contract"></span><h3>Basics of EOSIO Smart Contract<a class="headerlink" href="#basics-of-eosio-smart-contract" title="Permalink to this headline">¶</a></h3>
<p><strong>Communication Model</strong></p>
<p>EOSIO Smart Contracts communicate with each other in the form of actions and shared memory database access, e.g. a contract can read the state of another contract’s database as long as it is included within the read scope of the transaction with an async vibe. The async communication may result in spam which the resource limiting algorithm will resolve.
There are two communication modes that can be defined within a contract:</p>
<ul class="simple">
<li><strong>Inline</strong>. Inline is guaranteed to execute with the current transaction or unwind; no notification will be communicated regardless of success or failure. Inline operates with the same scopes and authorities the original transaction had.</li>
<li><strong>Deferred</strong>. Defer will get scheduled later at producer’s discretion; it’s possible to communicate the result of the communication or can simply timeout. Deferred can reach out to different scopes and carry the authority of the contract that sends them.</li>
</ul>
<p><strong>Action vs Transaction</strong></p>
<p>A action represents a single operation, whereas a transaction is a collection of one or more actions. A contract and an account communicate in the form of actions. Actions can be sent individually, or in combined form if they are intended to be executed as a whole.</p>
<p><em>Transaction with 1 action</em>.</p>
<div class="highlight-base notranslate"><div class="highlight"><pre><span></span>{
  &quot;expiration&quot;: &quot;2018-04-01T15:20:44&quot;,
  &quot;region&quot;: 0,
  &quot;ref_block_num&quot;: 42580,
  &quot;ref_block_prefix&quot;: 3987474256,
  &quot;net_usage_words&quot;: 21,
  &quot;kcpu_usage&quot;: 1000,
  &quot;delay_sec&quot;: 0,
  &quot;context_free_actions&quot;: [],
  &quot;actions&quot;: [{
      &quot;account&quot;: &quot;eosio.token&quot;,
      &quot;name&quot;: &quot;issue&quot;,
      &quot;authorization&quot;: [{
          &quot;actor&quot;: &quot;eosio&quot;,
          &quot;permission&quot;: &quot;active&quot;
        }
      ],
      &quot;data&quot;: &quot;00000000007015d640420f000000000004454f5300000000046d656d6f&quot;
    }
  ],
  &quot;signatures&quot;: [
    &quot;&quot;
  ],
  &quot;context_free_data&quot;: []
}
</pre></div>
</div>
<p><em>Transaction with multiple actions</em>, these actions should either all be successed or all failed.</p>
<div class="highlight-base notranslate"><div class="highlight"><pre><span></span>{
  &quot;expiration&quot;: &quot;...&quot;,
  &quot;region&quot;: 0,
  &quot;ref_block_num&quot;: ...,
  &quot;ref_block_prefix&quot;: ...,
  &quot;net_usage_words&quot;: ..,
  &quot;kcpu_usage&quot;: ..,
  &quot;delay_sec&quot;: 0,
  &quot;context_free_actions&quot;: [],
  &quot;actions&quot;: [{
      &quot;account&quot;: &quot;...&quot;,
      &quot;name&quot;: &quot;...&quot;,
      &quot;authorization&quot;: [{
          &quot;actor&quot;: &quot;...&quot;,
          &quot;permission&quot;: &quot;...&quot;
        }
      ],
      &quot;data&quot;: &quot;...&quot;
    }, {
      &quot;account&quot;: &quot;...&quot;,
      &quot;name&quot;: &quot;...&quot;,
      &quot;authorization&quot;: [{
          &quot;actor&quot;: &quot;...&quot;,
          &quot;permission&quot;: &quot;...&quot;
        }
      ],
      &quot;data&quot;: &quot;...&quot;
    }
  ],
  &quot;signatures&quot;: [
    &quot;&quot;
  ],
  &quot;context_free_data&quot;: []
}
</pre></div>
</div>
<p><strong>Action Name Restrictions</strong></p>
<p>Action types are actually <strong>base32 encoded 64-bit integers</strong>. This means they are limited to the characters a-z, 1-5, and ‘.’ for the first 12 characters. If there is a 13th character then it is restricted to the first 16 characters (‘.’ and a-p).</p>
<p><strong>Transaction Confirmation</strong></p>
<p>Receiving a transaction hash does not mean that the transaction has been confirmed, it only means that the node accepted it without error, which also means that there is a high probability other producers will accept it.</p>
<p>By means of confirmation, you should see the transaction in the transaction history with the block number of which it is included.</p>
</div>
</div>
<div class="section" id="smart-contract-files">
<span id="smart-contract-files"></span><h2>Smart Contract Files<a class="headerlink" href="#smart-contract-files" title="Permalink to this headline">¶</a></h2>
<p>It is easy to start with a template. I you have <a class="reference external" href="#python-knowledge">imported</a> <code class="docutils literal notranslate"><span class="pre">teos.py</span></code> module already,and if the contract name can be <code class="docutils literal notranslate"><span class="pre">tokenika</span></code>, use the creator of the <code class="docutils literal notranslate"><span class="pre">teos.ContractTemplate</span></code> class:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">template_tokenika</span> <span class="o">=</span> <span class="n">teos</span><span class="o">.</span><span class="n">ContractTemplate</span><span class="p">(</span><span class="s2">&quot;tokenika&quot;</span><span class="p">)</span>
<span class="c1">#  template contract: /mnt/c/Workspaces/EOS/eosfactory/contracts/tokenika</span>
</pre></div>
</div>
<p>Now, you have a new folder in the workspace. You can know the path to it…</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">template_tokenika</span><span class="o">.</span><span class="n">contract_dir</span>
<span class="c1"># &#39;/mnt/c/Workspaces/EOS/eosfactory/contracts/tokenika&#39;</span>
</pre></div>
</div>
<p>If you use the <code class="docutils literal notranslate"><span class="pre">Visual</span> <span class="pre">Studio</span> <span class="pre">Code</span></code>, you can open it in this contract folder. You will find there a configured, for EOSIO smart contract development, <em>InteliSense</em> space enabling code browsing. There you can (Ctrl+Shift+B) build the contract, producing WAST and ABI. We will add more of automatized functionality there: setting contract to the local node, running test, perhaps more.</p>
<p>The contract directory contains the source files of the contract:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">template_tokenika</span><span class="o">.</span><span class="n">hpp</span>
<span class="c1"># &#39;/mnt/c/Workspaces/EOS/eosfactory/contracts/tokenika/tokenika.hpp&#39;</span>

<span class="n">template_tokenika</span><span class="o">.</span><span class="n">cpp</span>
<span class="c1"># &#39;/mnt/c/Workspaces/EOS/eosfactory/contracts/tokenika/tokenika.cpp&#39;</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">template_tokenika.cpp</span></code> file is the source file that contains the functions of the contract.</p>
<p>Nota bene:</p>
<p>The original example in the EOSIO wiki <a class="reference external" href="#https://github.com/EOSIO/eos/wiki/Smart%20Contract">tutorial</a> does not compile. We guess that it is outdated. We use an example from <a class="reference external" href="#https://github.com/EOSIO/eos/wiki/Tutorial-Hello-World-Contract">another tutorial</a></p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;eosiolib/print.hpp&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;tokenika.hpp&gt;</span><span class="cp"></span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">eosio</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">hello</span> <span class="o">:</span> <span class="k">public</span> <span class="n">eosio</span><span class="o">::</span><span class="n">contract</span> <span class="p">{</span>
  <span class="k">public</span><span class="o">:</span>
      <span class="k">using</span> <span class="n">contract</span><span class="o">::</span><span class="n">contract</span><span class="p">;</span> 

      <span class="c1">/// @abi action </span>
      <span class="kt">void</span> <span class="nf">hi</span><span class="p">(</span> <span class="n">account_name</span> <span class="n">user</span> <span class="p">)</span> <span class="p">{</span>
         <span class="n">print</span><span class="p">(</span> <span class="s">&quot;Hello, &quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">{</span><span class="n">user</span><span class="p">}</span> <span class="p">);</span>
      <span class="p">}</span>
<span class="p">};</span>

<span class="n">EOSIO_ABI</span><span class="p">(</span> <span class="n">hello</span><span class="p">,</span> <span class="p">(</span><span class="n">hi</span><span class="p">)</span> <span class="p">)</span>
</pre></div>
</div>
<div class="section" id="wast">
<span id="wast"></span><h3>wast<a class="headerlink" href="#wast" title="Permalink to this headline">¶</a></h3>
<p>Any program to be deployed to the EOSIO blockchain must be compiled into WASM format. This is the only format the blockchain accepts.</p>
<p>Once you have the CPP file ready, you can compile it into a text version of WASM:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">wast</span> <span class="o">=</span> <span class="n">teos</span><span class="o">.</span><span class="n">WAST</span><span class="p">(</span><span class="n">template_tokenika</span><span class="o">.</span><span class="n">contract_dir</span><span class="p">)</span>
<span class="c1">#             WAST: /mnt/c/Workspaces/EOS/eosfactory/contracts/tokenika/build/tokenika.wast</span>
</pre></div>
</div>
<p>You can inspect the WAST, however, it is not interesting to us:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">wast</span><span class="o">.</span><span class="n">wast</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>..............
     (set_local $4
      (i32.sub
       (i32.const 2147483644)
       (get_local $2)
      )
     )
     (set_local $11
      (i32.add
       (get_local $0)
       (i32.const 8392)
      )
     )
     (set_local $12
      (i32.add
       (get_local $0)
       (i32.const 8384)
      )
     )
     (set_local $13
      (tee_local $3
       (i32.load offset=8392
        (get_local $0)
       )
      )
     )
     (loop $label$8
      (call $eosio_assert
       (i32.eq
        (i32.load
         (i32.add
          (tee_local $1
           (i32.add
            (get_local $0)
            (i32.mul
             (get_local $13)
             (i32.const 12)
            )
           )
          )
          (i32.const 8200)
         )
        )
        (i32.load
         (tee_local $5
          (i32.add
           (get_local $1)
           (i32.const 8192)
          )
         )
        )
       )
       (i32.const 8448)
      )
..............
</pre></div>
</div>
</div>
<div class="section" id="abi">
<span id="abi"></span><h3>abi<a class="headerlink" href="#abi" title="Permalink to this headline">¶</a></h3>
<p>The Application Binary Interface (ABI) is a JSON-based description on how to convert user actions between their JSON and Binary representations. The ABI also describes how to convert the database state to/from JSON. Once you have described your contract via an ABI then developers and users will be able to interact with your contract seamlessly via JSON.</p>
<p>The ABI file can be generated from the <code class="docutils literal notranslate"><span class="pre">.hpp</span></code> files:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">abi</span> <span class="o">=</span> <span class="n">teos</span><span class="o">.</span><span class="n">ABI</span><span class="p">(</span><span class="n">template_tokenika</span><span class="o">.</span><span class="n">contract_dir</span><span class="p">)</span>
<span class="c1">#             WAST: /mnt/c/Workspaces/EOS/eosfactory/contracts/tokenika/build/tokenika.wast</span>
</pre></div>
</div>
<p>You can inspect the ABI:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pprint</span>
<span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">abi</span><span class="o">.</span><span class="n">abi</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>{&#39;____comment&#39;: &#39;This file was generated by eosio-abigen. DO NOT EDIT - 2018-04-29T09:37:28&#39;, &#39;ricardian_clauses&#39;: &#39;&#39;, &#39;types&#39;: &#39;&#39;, &#39;actions&#39;: [{&#39;name&#39;: &#39;hi&#39;, &#39;type&#39;: &#39;hi&#39;, &#39;ricardian_contract&#39;: &#39;&#39;}], &#39;structs&#39;: [{&#39;name&#39;: &#39;hi&#39;, &#39;base&#39;: &#39;&#39;, &#39;fields&#39;: [{&#39;name&#39;: &#39;user&#39;, &#39;type&#39;: &#39;account_name&#39;}]}], &#39;tables&#39;: &#39;&#39;}
&gt;&gt;&gt; pprint.pprint(abi.abi)
{&#39;____comment&#39;: &#39;This file was generated by eosio-abigen. DO NOT EDIT - &#39;
                &#39;2018-04-29T09:37:28&#39;,
 &#39;actions&#39;: [{&#39;name&#39;: &#39;hi&#39;, &#39;ricardian_contract&#39;: &#39;&#39;, &#39;type&#39;: &#39;hi&#39;}],
 &#39;ricardian_clauses&#39;: &#39;&#39;,
 &#39;structs&#39;: [{&#39;base&#39;: &#39;&#39;,
              &#39;fields&#39;: [{&#39;name&#39;: &#39;user&#39;, &#39;type&#39;: &#39;account_name&#39;}],
              &#39;name&#39;: &#39;hi&#39;}],
 &#39;tables&#39;: &#39;&#39;,
 &#39;types&#39;: &#39;&#39;}
</pre></div>
</div>
<p>You will notice that this ABI defines an action <code class="docutils literal notranslate"><span class="pre">hi</span></code> of type <code class="docutils literal notranslate"><span class="pre">hi</span></code>. This tells EOSIO that when <code class="docutils literal notranslate"><span class="pre">${account}-&gt;hi</span></code> action is seen that the payload is of type <code class="docutils literal notranslate"><span class="pre">hi</span></code>. The type <code class="docutils literal notranslate"><span class="pre">hi</span></code> is defined in the <code class="docutils literal notranslate"><span class="pre">structs</span></code> array in the object with <code class="docutils literal notranslate"><span class="pre">name</span></code> set to <code class="docutils literal notranslate"><span class="pre">hi</span></code>.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span> &#39;structs&#39;: [{&#39;base&#39;: &#39;&#39;,
              &#39;fields&#39;: [{&#39;name&#39;: &#39;user&#39;, &#39;type&#39;: &#39;account_name&#39;}],
              &#39;name&#39;: &#39;hi&#39;}],
</pre></div>
</div>
<p>The ABI has one field, namely <code class="docutils literal notranslate"><span class="pre">name</span></code>. This fields has the type <code class="docutils literal notranslate"><span class="pre">account_name</span></code>. <code class="docutils literal notranslate"><span class="pre">account_name</span></code> is a built-in type used to represent base32 string as <code class="docutils literal notranslate"><span class="pre">uint64</span></code>. To see more about what built-in types are available, check <a class="reference external" href="https://github.com/EOSIO/eos/blob/master/libraries/chain/contracts/abi_serializer.cpp">here</a>.</p>
<p>The entry <code class="docutils literal notranslate"><span class="pre">types</span></code> is empty here. In general it is used to define a list of aliases for existing types. Here, we define <code class="docutils literal notranslate"><span class="pre">name</span></code> as an alias of <code class="docutils literal notranslate"><span class="pre">account_name</span></code>.</p>
</div>
</div>
<div class="section" id="debugging-smart-contract">
<span id="debugging-smart-contract"></span><h2>Debugging Smart Contract<a class="headerlink" href="#debugging-smart-contract" title="Permalink to this headline">¶</a></h2>
<p>In order to be able to debug your smart contract, you will need to setup local nodeos node. This local nodeos node can be run as separate private testnet or as an extension of public testnet (or the official testnet).</p>
<p>When you are creating your smart contract for the first time, it is recommended to test and debug your smart contract on a private testnet first, since you have full control of the whole blockchain. This enables you to have unlimited amount of eos needed and you can just reset the state of the blockchain whenever you want. When it is ready for production, debugging  on the public testnet (or official testnet) can be done by connecting your local nodeos to the public testnet (or official testnet) so you can see the log of the testnet in your local nodeos.</p>
<p>The concept is the same, so for the following guide, debugging on the private testnet will be covered.</p>
<p>If you haven’t set up your own local nodeos, please follow the <a class="reference external" href="https://github.com/EOSIO/eos/wiki/Local-Environment">setup guide</a>. By default, your local nodeos will just run in a private testnet unless you modify the config.ini file to connect with public testnet (or official testnet) nodes as described in the following <a class="reference external" href="Testnet%3A%20Public">guide</a>.</p>
<div class="section" id="method">
<span id="method"></span><h3>Method<a class="headerlink" href="#method" title="Permalink to this headline">¶</a></h3>
<p>The main method used to debug smart contract is <strong>Caveman Debugging</strong>, where we utilize the printing functionality to inspect the value of a variable and check the flow of the contract. Printing in smart contract can be done through the Print API (<a class="reference external" href="https://github.com/EOSIO/eos/blob/master/contracts/eoslib/print.h">C</a> and <a class="reference external" href="https://github.com/EOSIO/eos/blob/master/contracts/eoslib/print.hpp">C++</a>). The C++ API is the wrapper for C API, so most often we will just use the C++ API.</p>
</div>
<div class="section" id="print">
<span id="print"></span><h3>Print<a class="headerlink" href="#print" title="Permalink to this headline">¶</a></h3>
<p>Print C API supports the following data type that you can print:</p>
<ul class="simple">
<li>prints - a null terminated char array (string)</li>
<li>prints_l - any char array (string) with given size</li>
<li>printi - 64-bit unsigned integer</li>
<li>printi128 - 128-bit unsigned integer</li>
<li>printd - double encoded as 64-bit unsigned integer</li>
<li>printn - base32 string encoded as 64-bit unsigned integer</li>
<li>printhex - hex given binary of data and its size</li>
</ul>
<p>While Print C++ API wraps some of the above C API by overriding the print() function so user doesn’t need to determine which specific print function he needs to use. Print C++ API supports</p>
<ul class="simple">
<li>a null terminated char array (string)</li>
<li>integer (128-bit unsigned, 64-bit unsigned, 32-bit unsigned, signed, unsigned)</li>
<li>base32 string encoded as 64-bit unsigned integer</li>
<li>struct that has print() method</li>
</ul>
</div>
<div class="section" id="example">
<span id="example"></span><h3>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<p>Let’s write a new contract as example for debugging, named <code class="docutils literal notranslate"><span class="pre">debug</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">template_debug</span> <span class="o">=</span> <span class="n">teos</span><span class="o">.</span><span class="n">ContractTemplate</span><span class="p">(</span><span class="s2">&quot;debug&quot;</span><span class="p">)</span>
<span class="c1">#  template contract: /mnt/c/Workspaces/EOS/eosfactory/contracts/debug</span>
</pre></div>
</div>
<ul class="simple">
<li>debug.hpp</li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;eoslib/eos.hpp&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;eoslib/db.hpp&gt;</span><span class="cp"></span>

<span class="k">namespace</span> <span class="n">debug</span> <span class="p">{</span>
    <span class="k">struct</span> <span class="n">foo</span> <span class="p">{</span>
        <span class="n">account_name</span> <span class="n">from</span><span class="p">;</span>
        <span class="n">account_name</span> <span class="n">to</span><span class="p">;</span>
        <span class="kt">uint64_t</span> <span class="n">amount</span><span class="p">;</span>
        <span class="kt">void</span> <span class="nf">print</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span>
            <span class="n">eosio</span><span class="o">::</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Foo from &quot;</span><span class="p">,</span> <span class="n">eosio</span><span class="o">::</span><span class="n">name</span><span class="p">(</span><span class="n">from</span><span class="p">),</span> <span class="s">&quot; to &quot;</span><span class="p">,</span><span class="n">eosio</span><span class="o">::</span><span class="n">name</span><span class="p">(</span><span class="n">to</span><span class="p">),</span> <span class="s">&quot; with amount &quot;</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">};</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li>debug.cpp</li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;debug.hpp&gt;</span><span class="cp"></span>

<span class="k">extern</span> <span class="s">&quot;C&quot;</span> <span class="p">{</span>

    <span class="kt">void</span> <span class="n">init</span><span class="p">()</span>  <span class="p">{</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="n">apply</span><span class="p">(</span> <span class="kt">uint64_t</span> <span class="n">code</span><span class="p">,</span> <span class="kt">uint64_t</span> <span class="n">action</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">code</span> <span class="o">==</span> <span class="n">N</span><span class="p">(</span><span class="n">debug</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">eosio</span><span class="o">::</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Code is debug</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">action</span> <span class="o">==</span> <span class="n">N</span><span class="p">(</span><span class="n">foo</span><span class="p">))</span> <span class="p">{</span>
                 <span class="n">eosio</span><span class="o">::</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Action is foo</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
                <span class="n">debug</span><span class="o">::</span><span class="n">foo</span> <span class="n">f</span> <span class="o">=</span> <span class="n">eosio</span><span class="o">::</span><span class="n">current_message</span><span class="o">&lt;</span><span class="n">debug</span><span class="o">::</span><span class="n">foo</span><span class="o">&gt;</span><span class="p">();</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">amount</span> <span class="o">&gt;=</span> <span class="mi">100</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">eosio</span><span class="o">::</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Amount is larger or equal than 100</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="n">eosio</span><span class="o">::</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Amount is smaller than 100</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
                    <span class="n">eosio</span><span class="o">::</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Increase amount by 10</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
                    <span class="n">f</span><span class="p">.</span><span class="n">amount</span> <span class="o">+=</span> <span class="mi">10</span><span class="p">;</span>
                    <span class="n">eosio</span><span class="o">::</span><span class="n">print</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="c1">// extern &quot;C&quot;</span>
</pre></div>
</div>
<ul class="simple">
<li>debug.abi</li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s">&quot;structs&quot;</span><span class="o">:</span> <span class="p">[{</span>
      <span class="s">&quot;name&quot;</span><span class="o">:</span> <span class="s">&quot;foo&quot;</span><span class="p">,</span>
      <span class="s">&quot;base&quot;</span><span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
      <span class="s">&quot;fields&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">&quot;from&quot;</span><span class="o">:</span> <span class="s">&quot;account_name&quot;</span><span class="p">,</span>
        <span class="s">&quot;to&quot;</span><span class="o">:</span> <span class="s">&quot;account_name&quot;</span><span class="p">,</span>
        <span class="s">&quot;amount&quot;</span><span class="o">:</span> <span class="s">&quot;uint64&quot;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">],</span>
  <span class="s">&quot;actions&quot;</span><span class="o">:</span> <span class="p">[{</span>
      <span class="s">&quot;action_name&quot;</span><span class="o">:</span> <span class="s">&quot;foo&quot;</span><span class="p">,</span>
      <span class="s">&quot;type&quot;</span><span class="o">:</span> <span class="s">&quot;foo&quot;</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Let’s deploy it and send a message to it. Assume that you have <code class="docutils literal notranslate"><span class="pre">debug</span></code> account created and have its key in your wallet.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ eosiocpp -o debug.wast debug.cpp
$ cleos <span class="nb">set</span> contract debug debug.wast debug.abi
$ cleos push message debug foo <span class="s1">&#39;{&quot;from&quot;:&quot;inita&quot;, &quot;to&quot;:&quot;initb&quot;, &quot;amount&quot;:10}&#39;</span> --scope debug
</pre></div>
</div>
<p>When you check your local <code class="docutils literal notranslate"><span class="pre">nodeos</span></code> node log, you will see the following lines after the above message is sent.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Code</span> <span class="ow">is</span> <span class="n">debug</span>
<span class="n">Action</span> <span class="ow">is</span> <span class="n">foo</span>
<span class="n">Amount</span> <span class="ow">is</span> <span class="n">smaller</span> <span class="n">than</span> <span class="mi">100</span>
<span class="n">Increase</span> <span class="n">amount</span> <span class="n">by</span> <span class="mi">10</span>
<span class="n">Foo</span> <span class="kn">from</span> <span class="nn">inita</span> <span class="n">to</span> <span class="n">initb</span> <span class="k">with</span> <span class="n">amount</span> <span class="mi">20</span>
</pre></div>
</div>
<p>There, you can confirm that your message is going to the right control flow and the amount is updated correctly. You might see the above message at least 2 times and that’s normal because each transaction is being applied during verification, block generation, and block application.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="nav-item nav-item-0"><a href="index.html">Teos python 1.0 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Tokenika.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.4.
    </div>
  </body>
</html>