
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Tic-tac-toe contract on a remote testnet &#8212; EOSFactory 2.0 documentation</title>
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Debugging smart contracts" href="debugging.html" />
    <link rel="prev" title="Registering to a remote testnet" href="registering_to_testnode.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="debugging.html" title="Debugging smart contracts"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="registering_to_testnode.html" title="Registering to a remote testnet"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">EOSFactory 2.0 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <p>“”“</p>
<div class="section" id="tic-tac-toe-contract-on-a-remote-testnet">
<span id="tic-tac-toe-contract-on-a-remote-testnet"></span><h1>Tic-tac-toe contract on a remote testnet<a class="headerlink" href="#tic-tac-toe-contract-on-a-remote-testnet" title="Permalink to this headline">¶</a></h1>
<p>This file can be executed as a python script: ‘python3 account_master.md’.</p>
<div class="section" id="set-up">
<span id="set-up"></span><h2>Set-up<a class="headerlink" href="#set-up" title="Permalink to this headline">¶</a></h2>
<p>The set-up statements are explained at <a href="setup.html">cases/setup</a>.</p>
<div class="highlight-md notranslate"><div class="highlight"><pre>Test with a local node are perfectly reproducible and forgivable. It is not so
with remote test nodes because such tests have to -- otherwise they are 
useless -- mimic real uses when blockchain changes are to be paid.

With remote node tests, we assume the following restrictions.

    * Accounts have to be reused between test sessions.
    * Contract deployment occurs only if contract changes.
    * Wallet passwords are not stored in a plain file.
</pre></div>
</div>
<div class="section" id="imports-and-set-up-definitions">
<span id="imports-and-set-up-definitions"></span><h3>Imports and set-up definitions<a class="headerlink" href="#imports-and-set-up-definitions" title="Permalink to this headline">¶</a></h3>
<div class="highlight-md notranslate"><div class="highlight"><pre>&quot;&quot;&quot;
import os
import re
import unittest
import setup
import eosf
import eosf_account
import eosf_wallet
from user_data import *

from eosf_wallet import Wallet
from eosf_account import account_create, account_master_create
from eosf_contract import Contract

setup.remote_testnet_setup(&quot;88.99.97.30:38888&quot;)
WALLET_NAME = setup.wallet_default_name

ACCOUNT_MASTER = &quot;account_master&quot;
ACCOUNT_TTT = &quot;account_tic_tac_toe&quot;
_ = eosf.Logger()
&quot;&quot;&quot;
</pre></div>
</div>
<div class="section" id="unittest-test-class-definition-begins-here">
<span id="unittest-test-class-definition-begins-here"></span><h4>Unittest test class definition begins here<a class="headerlink" href="#unittest-test-class-definition-begins-here" title="Permalink to this headline">¶</a></h4>
<div class="highlight-md notranslate"><div class="highlight"><pre>&quot;&quot;&quot;
class Test(unittest.TestCase):

    def setUp(self):
        eosf.set_throw_error(True)
        eosf.stop([eosf.Verbosity.TRACE])
        eosf.use_keosd(True)
        eosf.info()
        exit()
        &quot;&quot;&quot;
</pre></div>
</div>
</div>
<div class="section" id="wallet-passwords-are-not-stored-in-an-open-file-automatically">
<span id="wallet-passwords-are-not-stored-in-an-open-file-automatically"></span><h4>Wallet passwords are not stored in an open file automatically<a class="headerlink" href="#wallet-passwords-are-not-stored-in-an-open-file-automatically" title="Permalink to this headline">¶</a></h4>
<p>For tests, we use wallets of improbable names. On creation, its password is
stored in a file, with local code, and can be automatically reused between
sessions.</p>
<p>If the test wallet has to be deleted, use the following code:</p>
<div class="highlight-md notranslate"><div class="highlight"><pre>import os
import eosf
from user_data import *

eosf.use_keosd(True)
eosf.kill_keosd()

try:
    wallet_file = eosf.wallet_dir() + WALLET_NAME + &quot;.wallet&quot;
    os.remove(wallet_file)
    print(&quot;The deleted wallet file:\n{}\n&quot;.format(wallet_file))
except Exception as e:
    print(&quot;Cannot delete the wallet file:\n{}\n&quot;.format(str(e))) 
</pre></div>
</div>
<div class="highlight-md notranslate"><div class="highlight"><pre>        &quot;&quot;&quot;
        eosf.kill_keosd()
        wallet_json = eosf_wallet.wallet_json_read()
        if not WALLET_NAME in wallet_json:
            wallet = Wallet(WALLET_NAME, verbosity=[eosf.Verbosity.TRACE])
            wallet_json[WALLET_NAME] = wallet.password
            eosf_wallet.wallet_json_write(wallet_json)
        else:
            wallet = Wallet(
                WALLET_NAME, wallet_json[WALLET_NAME],
                verbosity=[eosf.Verbosity.TRACE])

        exit()
        &quot;&quot;&quot;
</pre></div>
</div>
</div>
<div class="section" id="accounts-are-reused-between-test-sessions">
<span id="accounts-are-reused-between-test-sessions"></span><h4>Accounts are reused between test sessions<a class="headerlink" href="#accounts-are-reused-between-test-sessions" title="Permalink to this headline">¶</a></h4>
<p>When the singleton ‘Wallet’ object is created, it reads the EOSFactory account
mapping file (kept in the wallet directory) and attempts to create account
objects, in the global namespace, wrapping all the physical accounts listed
there. Therefore, an account object is to be created only if it does not exist.</p>
<p>We use the registration account as the contract holder. The factory function
‘account_master_create’ creates the object, named for the ‘ACCOUNT_MASTER’
constant, in the global namespace. Other arguments of the factory are defined
in the ‘user_data.py’ script.</p>
<p>The factory function puts the created account object into the wallet.</p>
<div class="highlight-md notranslate"><div class="highlight"><pre>        &quot;&quot;&quot;
        ACCOUNT_MASTER = ACCOUNT_TTT
        if not ACCOUNT_MASTER in globals():
            account_master_create(
                ACCOUNT_MASTER, ACCOUNT_NAME, OWNER_KEY, ACTIVE_KEY,
                verbosity=[eosf.Verbosity.TRACE, eosf.Verbosity.OUT])
        else:
            _.TRACE(&quot;&quot;&quot;
            ######## {} account object restored from the blockchain.
            &quot;&quot;&quot;.format(ACCOUNT_MASTER))
        
        
        global account_master
        account_master = globals()[ACCOUNT_MASTER]
        global account_tic_tac_toe
        account_tic_tac_toe = globals()[ACCOUNT_TTT]
        account_tic_tac_toe.info()

        contract_tic_tac_toe = Contract(
            account_tic_tac_toe, &quot;tic_tac_toe_jungle&quot;)        
        contract_tic_tac_toe.build()
        if not account_tic_tac_toe.is_code():            
            contract_tic_tac_toe.deploy()
        else:
            _.TRACE(&quot;&quot;&quot;
            * Contract cannot be deployed as the account already has a code.
                The current test is protected against overwriting the code.
            &quot;&quot;&quot;)
        &quot;&quot;&quot;
</pre></div>
</div>
</div>
<div class="section" id="the-insufficient-ram-error">
<span id="the-insufficient-ram-error"></span><h4>The ‘insufficient ram` error<a class="headerlink" href="#the-insufficient-ram-error" title="Permalink to this headline">¶</a></h4>
<p>As the remote node takes quasi-money (but we test the real-money case), you can
expect a message like this one:</p>
<div class="highlight-md notranslate"><div class="highlight"><pre>ERROR:
Reading WAST/WASM from eosfactory/contracts/tic_tac_toe_jungle/build/tic_tac_toe.wast...
Assembling WASM...
Publishing contract...
Error 3080001: Account using more than allotted RAM usage
Error Details:
account dgxo1uyhoytn has insufficient ram; needs 138233 bytes has 64789 bytes
</pre></div>
</div>
<div class="highlight-md notranslate"><div class="highlight"><pre>        &quot;&quot;&quot;
        if not &quot;account_alice&quot; in globals():
            account_create(&quot;account_alice&quot;, account_master)
        else:
            _.TRACE(&quot;&quot;&quot;
            ######## {} account object restored from the blockchain.
            &quot;&quot;&quot;.format(&quot;account_alice&quot;))
        if not &quot;account_carol&quot; in globals():    
            account_create(&quot;account_carol&quot;, account_master)
        else:
            _.TRACE(&quot;&quot;&quot;
            ######## {} account object restored from the blockchain.
            &quot;&quot;&quot;.format(&quot;account_carol&quot;))

        eosf.set_throw_error(False)
        eosf.set_is_testing_errors()            
        exit()
    def test_tic_tac_toe(self):
        &quot;&quot;&quot;
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="case">
<span id="case"></span><h2>Case<a class="headerlink" href="#case" title="Permalink to this headline">¶</a></h2>
<p>Given a <code class="docutils literal notranslate"><span class="pre">Wallet</span></code> class object in the global namespace; an account  master
object named <code class="docutils literal notranslate"><span class="pre">account_master</span></code> in the global namespace; given an account
object named <code class="docutils literal notranslate"><span class="pre">account_tic_tac_toe</span></code> account that keeps the <code class="docutils literal notranslate"><span class="pre">tic_tac_toe</span></code>
contract; and given two player accounts: <code class="docutils literal notranslate"><span class="pre">account_alice</span></code> and <code class="docutils literal notranslate"><span class="pre">account_carol</span></code>
– run games.</p>
<div class="highlight-md notranslate"><div class="highlight"><pre>        &quot;&quot;&quot;
        account_tic_tac_toe.push_action(
            &quot;create&quot;, 
            {
                &quot;challenger&quot;: account_alice, 
                &quot;host&quot;: account_carol
            },
            account_carol)

        t = account_tic_tac_toe.table(&quot;games&quot;, account_carol)
        self.assertFalse(t.error)

        self.assertEqual(t.json[&quot;rows&quot;][0][&quot;board&quot;][0], 0)
        self.assertEqual(t.json[&quot;rows&quot;][0][&quot;board&quot;][1], 0)
        self.assertEqual(t.json[&quot;rows&quot;][0][&quot;board&quot;][2], 0)
        self.assertEqual(t.json[&quot;rows&quot;][0][&quot;board&quot;][3], 0)
        self.assertEqual(t.json[&quot;rows&quot;][0][&quot;board&quot;][4], 0)
        self.assertEqual(t.json[&quot;rows&quot;][0][&quot;board&quot;][5], 0)
        self.assertEqual(t.json[&quot;rows&quot;][0][&quot;board&quot;][6], 0)
        self.assertEqual(t.json[&quot;rows&quot;][0][&quot;board&quot;][7], 0)
        self.assertEqual(t.json[&quot;rows&quot;][0][&quot;board&quot;][8], 0)

        account_tic_tac_toe.push_action(
            &quot;move&quot;, 
            {
                &quot;challenger&quot;: account_alice, 
                &quot;host&quot;: account_carol, 
                &quot;by&quot;: account_carol,  
                &quot;row&quot;:0, &quot;column&quot;:0 
            }, 
            account_carol)

        account_tic_tac_toe.push_action(
            &quot;move&quot;, 
            {
                &quot;challenger&quot;: account_alice,  
                &quot;host&quot;: account_carol,  
                &quot;by&quot;: account_alice, 
                &quot;row&quot;:1, &quot;column&quot;:1 
            }, 
            account_alice)

        t = account_tic_tac_toe.table(&quot;games&quot;, account_carol)

        self.assertEqual(t.json[&quot;rows&quot;][0][&quot;board&quot;][0], 1)
        self.assertEqual(t.json[&quot;rows&quot;][0][&quot;board&quot;][1], 0)
        self.assertEqual(t.json[&quot;rows&quot;][0][&quot;board&quot;][2], 0)
        self.assertEqual(t.json[&quot;rows&quot;][0][&quot;board&quot;][3], 0)
        self.assertEqual(t.json[&quot;rows&quot;][0][&quot;board&quot;][4], 2)
        self.assertEqual(t.json[&quot;rows&quot;][0][&quot;board&quot;][5], 0)
        self.assertEqual(t.json[&quot;rows&quot;][0][&quot;board&quot;][6], 0)
        self.assertEqual(t.json[&quot;rows&quot;][0][&quot;board&quot;][7], 0)
        self.assertEqual(t.json[&quot;rows&quot;][0][&quot;board&quot;][8], 0)

        account_tic_tac_toe.push_action(
                &quot;restart&quot;, 
                {
                    &quot;challenger&quot;: account_alice, 
                    &quot;host&quot;: account_carol, 
                    &quot;by&quot;: account_carol
                }, 
                account_carol)

        t = account_tic_tac_toe.table(&quot;games&quot;, account_carol)
        self.assertFalse(t.error)

        self.assertEqual(t.json[&quot;rows&quot;][0][&quot;board&quot;][0], 0)
        self.assertEqual(t.json[&quot;rows&quot;][0][&quot;board&quot;][1], 0)
        self.assertEqual(t.json[&quot;rows&quot;][0][&quot;board&quot;][2], 0)
        self.assertEqual(t.json[&quot;rows&quot;][0][&quot;board&quot;][3], 0)
        self.assertEqual(t.json[&quot;rows&quot;][0][&quot;board&quot;][4], 0)
        self.assertEqual(t.json[&quot;rows&quot;][0][&quot;board&quot;][5], 0)
        self.assertEqual(t.json[&quot;rows&quot;][0][&quot;board&quot;][6], 0)
        self.assertEqual(t.json[&quot;rows&quot;][0][&quot;board&quot;][7], 0)
        self.assertEqual(t.json[&quot;rows&quot;][0][&quot;board&quot;][8], 0)

        account_tic_tac_toe.push_action(
                &quot;close&quot;, 
                {
                    &quot;challenger&quot;: account_alice,  
                    &quot;host&quot;: account_carol 
                }, 
                account_carol)

    def tearDown(self):
        eosf.stop()
&quot;&quot;&quot;
</pre></div>
</div>
<div class="section" id="run-the-unittest">
<span id="run-the-unittest"></span><h3>Run the unittest<a class="headerlink" href="#run-the-unittest" title="Permalink to this headline">¶</a></h3>
<div class="highlight-md notranslate"><div class="highlight"><pre>&quot;&quot;&quot;
unittest.main()
&quot;&quot;&quot;
</pre></div>
</div>
<p>“”“</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Tic-tac-toe contract on a remote testnet</a><ul>
<li><a class="reference internal" href="#set-up">Set-up</a><ul>
<li><a class="reference internal" href="#imports-and-set-up-definitions">Imports and set-up definitions</a><ul>
<li><a class="reference internal" href="#unittest-test-class-definition-begins-here">Unittest test class definition begins here</a></li>
<li><a class="reference internal" href="#wallet-passwords-are-not-stored-in-an-open-file-automatically">Wallet passwords are not stored in an open file automatically</a></li>
<li><a class="reference internal" href="#accounts-are-reused-between-test-sessions">Accounts are reused between test sessions</a></li>
<li><a class="reference internal" href="#the-insufficient-ram-error">The ‘insufficient ram` error</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#case">Case</a><ul>
<li><a class="reference internal" href="#run-the-unittest">Run the unittest</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="registering_to_testnode.html"
                        title="previous chapter">Registering to a remote testnet</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="debugging.html"
                        title="next chapter">Debugging smart contracts</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/cases/remote_tic_tac_toe.md.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="debugging.html" title="Debugging smart contracts"
             >next</a> |</li>
        <li class="right" >
          <a href="registering_to_testnode.html" title="Registering to a remote testnet"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">EOSFactory 2.0 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Tokenika.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.6.
    </div>
  </body>
</html>